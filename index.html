<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sample Chat- Bold360</title>
</head>
<body>
    <button id="startChat">Start chat</button>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
        function showWidget() {
            (function() {
                window._bcvma = window._bcvma || [];
                _bcvma.push(["setAccountID", "794130127792834009"]);
                _bcvma.push(["setParameter", "WebsiteID", "788119547699982764"]);
                _bcvma.push(["setParameter", "InvitationID", "788119547909269704"]);
                _bcvma.push(["setParameter", "VisitName", "test"]);
                _bcvma.push(["setParameter", "VisitEmail", "test@cleartrip.com"]);
                _bcvma.push(["setParameter", "CustomUrl", ""]);
                _bcvma.push(["setParameter", "WindowParameters", "customField_trip_id=1234567890&customField_platform=Desktop"]);
                _bcvma.push(["pageViewed", document.location.href, document.referrer]);
                var bcLoad = function() {
                    if(window.bcLoaded) return;
                    window.bcLoaded = true;
                    var vms = document.createElement("script");
                    vms.type = "text/javascript"; vms.async = true;
                    vms.src = ('https:'==document.location.protocol?'https://':'http://') + "vmss.boldchat.com/aid/794130127792834009/bc.vms4/vms.js";
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(vms, s);
                };
                if(window.pageViewer && pageViewer.load) pageViewer.load();
                else if(document.readyState=="complete") bcLoad();
                else if(window.addEventListener) window.addEventListener('load', bcLoad, false);
                else window.attachEvent('onload', bcLoad);
            })();

            // if(window.bcChatWindows) {
            //     if(window.bcChatWindows.length) {
            //         $('.bc-minimize-state-container').trigger('click');
            //     }
            //     else{
            //         $('.bcFloat a').trigger('click');
            //     }
            // }
            // else {
            //     function startChatInterval() {
            //         if($('.bcFloat a').length) {
            //             $('.bcFloat a').trigger('click');
            //             clearChatInterval();
            //         }
            //     }
            //     function clearChatInterval() {
            //         clearInterval(chatOpenInterval);
            //         setTimeout(function() {
            //             var _tEvents = {
            //                 "new-message": "bc_newHistoryMessageCallback",
            //                 "chat-closed": "bc_chatClosedEventCallback",
            //                 "chat-ended": "bc_chatEndedEventCallback",
            //                 "push-page": "bc_pushPageEventCallback",
            //                 "page-loaded": "bc_chatWindowLoadedEventCallback",
            //                 "resize": "bc_resizeEventCallback"
            //             },
            //             _tFunction = function(i, type, fName) {
            //                 console.warn("event \"" + i + "\" captured inside the frame with " + type + (fName ? " (function name is '" + fName + "')" : ""));
            //             };
            //             for (var i in _tEvents) {
            //                 bcChatWindows[0].addListener(i, _tFunction.bind(window, i, "listener"));
            //                 window[_tEvents[i]] = _tFunction.bind(window, i, "function", _tEvents[i]);
            //             }
            //             bcChatWindows[0].addListener('chat-ended', function() {
            //                 console.log('Chat ended');
            //             });
            //             bcChatWindows[0].addListener('chat-closed', function() {
            //                 console.log('Chat closed');
            //                 $('.bcFloat').hide();
            //             });
            //         }, 3000);    
            //     }
            //     var chatOpenInterval = setInterval(startChatInterval, 500);
            // }

            function startChat() {
                function startChatInterval() {
                    if($('.bcFloat a').length) {
                        $('.bcFloat a').trigger('click');
                        clearChatInterval();
                    }
                }
                function clearChatInterval() {
                    clearInterval(chatOpenInterval);
                    setTimeout(function() {
                        var _tEvents = {
                            "new-message": "bc_newHistoryMessageCallback",
                            "chat-closed": "bc_chatClosedEventCallback",
                            "chat-ended": "bc_chatEndedEventCallback",
                            "push-page": "bc_pushPageEventCallback",
                            "page-loaded": "bc_chatWindowLoadedEventCallback",
                            "resize": "bc_resizeEventCallback"
                        },
                        _tFunction = function(i, type, fName) {
                            console.warn("event \"" + i + "\" captured inside the frame with " + type + (fName ? " (function name is '" + fName + "')" : ""));
                        };
                        for (var i in _tEvents) {
                            bcChatWindows[0].addListener(i, _tFunction.bind(window, i, "listener"));
                            window[_tEvents[i]] = _tFunction.bind(window, i, "function", _tEvents[i]);
                        }
                        bcChatWindows[0].addListener('chat-ended', function() {
                            console.log('Chat ended');
                        });
                        bcChatWindows[0].addListener('chat-closed', function() {
                            console.log('Chat closed');
                            $('.bcFloat').hide();
                        });
                    }, 3000);    
                }
                var chatOpenInterval = setInterval(startChatInterval, 500);
            }

            if(window.bcChatWindows) {
                if(window.bcChatWindows.length) {
                    $('.bc-minimize-state-container').trigger('click');
                }
                else{
                    startChat();
                }
            }
            else {
                startChat();
            }

            // var url = 'https://api.boldchat.com/aid/794130127792834009/rest/json/v1/createChat';

            // $.ajax({
            //     "async": true,
            //     "crossDomain": true,
            //     "url": url,
            //     "type": "POST",
            //     "contentType": "application/x-www-form-urlencoded",
            //     "headers": {
            //         "authorization": 'Basic ' + btoa('794130127792834009:788126291309184179:Q27PqEuCUCaxOnwJoZein2+N4OVZR+tT')
            //     },
            //     "data": {
            //         Data: JSON.stringify({
            //             "custom_trip_id": "1234567890",
            //             "name": "test test",
            //             "email": "test.test@cleartrip.com"
            //         }),
            //         SkipPreChat: true
            //     } 
            // }).done(function (response) {
            //     console.log(response);
            // });
        }
        $('#startChat').on('click', showWidget);
    </script>
</body>
</html>